ARG VERSION=0.46.0

FROM ghcr.io/astral-sh/uv:python3.11-trixie-slim AS builder
ARG VERSION
RUN uv tool install pyrefly==${VERSION}

FROM gcr.io/distroless/cc-debian12
ARG VERSION
LABEL org.opencontainers.image.title="Pyrefly LSP" \
      org.opencontainers.image.description="Pyrefly Language Server" \
      org.opencontainers.image.version="${VERSION}" \
      org.opencontainers.image.source="https://github.com/wangbowei/lsp-client" \
      org.opencontainers.image.licenses="MIT"

COPY --from=builder /usr/local/bin/pyrefly /usr/local/bin/pyrefly

WORKDIR /workspace
USER 65532:65532
ENTRYPOINT ["/usr/local/bin/pyrefly", "lsp"]
