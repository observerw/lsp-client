ARG VERSION=1.1.407
FROM node:22-alpine AS builder
ARG VERSION
WORKDIR /app
RUN apk add --no-cache curl && \
    curl -sf https://gobinaries.com/tj/node-prune | sh && \
    npm install pyright@${VERSION} && \
    npm prune --production && \
    /usr/local/bin/node-prune

FROM node:22-alpine
ARG VERSION
LABEL org.opencontainers.image.version="${VERSION}"
WORKDIR /app
COPY --from=builder /app/node_modules ./node_modules
ENV PATH="/app/node_modules/.bin:${PATH}"

WORKDIR /workspace
ENTRYPOINT ["pyright-langserver", "--stdio"]
