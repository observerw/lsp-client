ARG VERSION=latest
FROM docker.io/library/golang:1.23-alpine AS builder
ARG VERSION
WORKDIR /app
RUN apk add --no-cache git && \
    go install golang.org/x/tools/gopls@${VERSION}

FROM docker.io/library/golang:1.23-alpine
ARG VERSION
LABEL org.opencontainers.image.title="Gopls LSP" \
      org.opencontainers.image.description="Go Language Server" \
      org.opencontainers.image.version="${VERSION}" \
      org.opencontainers.image.source="https://github.com/wangbowei/lsp-client" \
      org.opencontainers.image.licenses="MIT"

WORKDIR /app
COPY --from=builder /go/bin/gopls /usr/local/bin/gopls

WORKDIR /workspace
ENTRYPOINT ["gopls", "serve"]
